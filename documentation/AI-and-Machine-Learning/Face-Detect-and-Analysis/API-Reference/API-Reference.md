# 人脸检测与属性分析

----------

## 一、接口描述 

### 1.功能描述

人脸自然属性识别API主要用于对传入的图片中所有人脸的自然属性判别，主要有：人脸框，人脸关键点信息，人脸姿态估计，9种自然属性，分别为（性别、年龄、种族、微笑、颜值，是否带墨镜，是否带眼镜，人脸是否遮挡，是否有胡子）以及5种情绪(惊讶，高兴，悲伤，生气，平静)的分析。使用者可以根据实际的使用场景选择所需的属性判别结果，api结果将返回人脸位置及相应的属性值。不适用于大规模人脸很小的合影照。

### 2. 接口使用 
公测期间用户可以免费（0元）进行测试，根据[购买流程](../Pricing/Purchase-Process.md)下单后，即可开始体验业内领先的人工智能API服务。公测期间服务具有调用量、QPS限制，如需更高性能的API服务，请联系客服扩容购买。


在获得使用权限后，您可使用已经封装好的SDK/参照[接口鉴权](../Operation-Guide/Authentication.md)规则进行相应开发，整体流程详见[调用方法](../Operation-Guide/call-methods.md)  。

### 3.图片要求

> 1. 图片格式：bmp, jpg, jpeg, png, jfif
> 2. 图片像素尺寸：最小 48\*48 像素，最大 4096\*4096 像素
> 3. 图片文件大小：小于2MB

## 二、请求说明

### 1. 接口地址 ：

```
https://aiapi.jdcloud.com/jdai/face_detect_attr
```

### 2. 请求方式：
  
https `post` aiapi.jdcloud.com/jdai/face_detect_attr

### 3. 请求参数  
 
#### （1）header请求参数
业务请求参数
<table>
   <tr>
      <th>名称</th>
      <th>类型</th>
      <th>必填</th>
      <th>示例值</th>
      <th>描述</th>
   </tr>
   <tr>
      <td>Authorization</td>
      <td>string</td>
      <td>是</td>
      <td>JDCLOUD2-HMAC-SHA256Credential=access...</td>
      <td>签名</td>
   </tr>
</table>

#### （2）body请求参数
业务请求参数
<table>
   <tr>
      <th>名称</th>
      <th>类型</th>
      <th>必填</th>
      <th>示例值</th>
      <th>描述</th>
   </tr>
   <tr>
      <td>imageBase64</td>
      <td>string</td>
      <td>是</td>
      <td>图像Base64编码值，由于过长，不给出示例</td>
      <td>图片Base64编码</td>
   </tr>
   <tr>
      <td>return_landmark</td>
      <td>int</td>
      <td>否</td>
      <td>0</td>
      <td>是否返回关键点，0为不返回，1为返回25个关键点，2为返回106个关键点，默认为0</td>
   </tr>
   <tr>
      <td>return_attr</td>
      <td>int</td>
      <td>否</td>
      <td>0</td>
      <td>是否返回人脸属性，0为不返回，1为返回，默认为0</td>
   </tr>
   <tr>
      <td>face_detect_num</td>
      <td>int</td>
      <td>否</td>
      <td>5</td>
      <td>最多处理人脸的数目，默认值为0，检测图片中所有的人脸，并返回相应的属性值, 人脸数目不超过100</td>
   </tr>
</table>

### 4、请求代码示例
建议您使用我们提供的SDK进行调用，SDK获取及调用方式详见[sdk的使用方法](../Operation-Guide/Use-Sdk.md)
 
## 返回说明

### 1、返回参数
#### （1）公共返回参数

<table>
   <tr>
      <th>名称</th>
      <th>类型</th>
      <th>示例值</th>
      <th>描述</th>
   </tr>
   <tr>
      <td>code</td>
      <td>string</td>
      <td>1000</td>
      <td>参见下方错误码-系统级错误码</td>
   </tr>
      <tr>
      <td>charge</td>
      <td>boolean</td>
      <td>false 或 true</td>
      <td>false：不扣费， true：扣费</td>
   </tr>
      <tr>
      <td>remain</td>
      <td>long</td>
      <td>1305</td>
      <td>按天计算剩余调用次数</td>
   </tr>
      </tr>
      <tr>
      <td>msg</td>
      <td>string</td>
      <td>查询成功</td>
      <td>参见下方错误码-系统级错误码数</td>
   </tr>
      </tr>
      <tr>
      <td>result</td>
      <td>object</td>
      <td>{...}</td>
      <td>查询结果</td>
   </tr>
</table>

#### （2）业务返回参数

<table>
   <tr>
      <th>名称</th>
      <th>类型</th>
      <th>示例值</th>
      <th>描述</th>
   </tr>
   <tr>
      <td>status</td>
      <td>int</td>
      <td>0</td>
      <td>返回结果，0表示成功，非0为对应错误号</td>
   </tr>
   <tr>
      <td>message</td>
      <td>string</td>
      <td>Success</td>
      <td>错误信息</td>
   </tr>
   <tr>
      <td>faceNum</td>
      <td>int</td>
      <td>2</td>
      <td>被检测出人脸的个数</td>
   </tr>
   <tr>
      <td>faces</td>
      <td>array</td>
      <td>[{...},{...}]</td>
      <td>被检测出的人脸数组</td>
   </tr>
</table>
 
**faces数组中单个元素的结构：**

<table>
   <tr>
      <th>名称</th>
      <th>类型</th>
      <th>示例值</th>
      <th>描述</th>
   </tr>
   <tr>
      <td>faceDetectionResult</td>
      <td>object</td>
      <td>"faceDetectionResult":
                {
                    "conf":0.9979284,
                    "height":248.6062,
                    "left":130.61546,
                    "pitch":-13.489692,
                    "points":
                    [
                        {"id":"1","x":182.95001,"y":336.23602},
                        {"id":"2","x":280.43008,"y":317.094},
                        ....
                        {"id":"25","x":261.8835,"y":481.9718}
                    ],
                    "roll":-10.862732,
                    "top":217.24722,
                    "width":206.0797,
                    "yaw":-2.1396933
                }</td>
      <td>人脸识别矩形框的位置，包括以下属性值：<br/>
      left：矩形框左上角像素点的横坐标<br/>
      top：矩形框左上角像素点的纵坐标<br/>
      width：矩形框的宽度<br/>
      height：矩形框的高度</td>
      conf: 人脸置信度 </td>
      roll: 人脸歪头的角度 </td>
      yaw: 人脸左右摇头的角度 </td>
      pitch: 人脸上下点头的角度 </td>
      points: 人脸关键点 </td>
   </tr>
   <tr>
      <td>faceAttribute</td>
      <td>object</td>
      <td>"faceAttribute":
                {
                    "age":13,
                    "beard":0,
                    "beauty":69.65329,
                    "emotion":3,
                    "eyeglasses":0,
                    "gender":1,
                    "mask":0,
                    "race":0,
                    "smile":21.505215,
                    "sunglasses":0
                }</td>
      <td>人脸识别的自然属性值，包括以下字段，且均为string：<br>
      age: 年龄<br/>
      gender: 性别, 0为女性，1为男性<br/>
      race: 种族, 0白种人 1黑种人 2黄种人<br/>
      emotion: 0为惊讶，3为高兴，4为悲伤，5为生气，6为平静<br/>
      beard: 是否有胡子,0否，1是<br/>
      mask: 是否带口罩，0否，1是<br/>
      eyeglasses: 是否戴眼镜，0否，1是<br/>
      sunglasses: 是否带墨镜，0否，1是<br/>
      smile：微笑<br/>
      beauty：颜值</td>
   </tr>
</table>

### 2、返回示例

```Json
{
    "status": 0, 
    "charge": false,
    "remain": 97,
    "msg": "查询成功",
    "result": 
    {
    		"requestid": "5893465d31284468a8014de6ee430f8e",
        "errorMsg":"success",
        "faceNum":2,
        "faces":
        [
            {
                "faceAttribute":
                {
                    "age":13,
                    "beard":0,
                    "beauty":69.65329,
                    "emotion":3,
                    "eyeglasses":0,
                    "gender":1,
                    "mask":0,
                    "race":0,
                    "smile":21.505215,
                    "sunglasses":0
                },
                "faceDetectionResult":
                {
                    "conf":0.9979284,
                    "height":248.6062,
                    "left":130.61546,
                    "pitch":-13.489692,
                    "points":
                    [
                        {"id":"1","x":182.95001,"y":336.23602},
                        {"id":"2","x":280.43008,"y":317.094},
                        {"id":"3","x":143.76604,"y":323.54022},
                        {"id":"4","x":202.72226,"y":315.76984},
                        {"id":"5","x":251.93193,"y":305.6577},
                        {"id":"6","x":312.30237,"y":290.91382},
                        {"id":"7","x":230.36914,"y":325.7189},
                        {"id":"8","x":241.39957,"y":386.72913},
                        {"id":"9","x":249.25041,"y":420.46594},
                        {"id":"10","x":253.68869,"y":442.1404},
                        {"id":"11","x":212.0619,"y":431.59692},
                        {"id":"12","x":290.02234,"y":416.03897},
                        {"id":"13","x":265.28052,"y":390.88385},
                        {"id":"14","x":222.38489,"y":399.56726},
                        {"id":"15","x":251.12921,"y":429.38632},
                        {"id":"16","x":244.89241,"y":401.36395},
                        {"id":"17","x":205.1922,"y":336.0168},
                        {"id":"18","x":182.9361,"y":343.09613},
                        {"id":"19","x":162.54597,"y":340.50223},
                        {"id":"20","x":301.3431,"y":313.41156},
                        {"id":"21","x":281.96387,"y":323.736},
                        {"id":"22","x":259.6537,"y":325.03998},
                        {"id":"23","x":170.6153,"y":312.89862},
                        {"id":"24","x":281.84644,"y":290.98724},
                        {"id":"25","x":261.8835,"y":481.9718}
                    ],
                    "roll":-10.862732,
                    "top":217.24722,
                    "width":206.0797,
                    "yaw":-2.1396933
                }
            },
            {
                "faceAttribute":
                {
                    "age":8,
                    "beard":0,
                    "beauty":83.39522,
                    "emotion":3,
                    "eyeglasses":0,
                    "gender":0,
                    "mask":0,
                    "race":0,
                    "smile":70.24126,
                    "sunglasses":0
                },
                "faceDetectionResult":
                {
                    "conf":0.9919769,
                    "height":227.42416,
                    "left":351.1377,
                    "pitch":-16.438887,
                    "points":
                    [
                        {"id":"1","x":397.53885,"y":172.85367},
                        {"id":"2","x":487.776,"y":178.55371},
                        {"id":"3","x":366.0182,"y":151.2645},
                        {"id":"4","x":420.70135,"y":158.58098},
                        {"id":"5","x":467.41974,"y":161.50757},
                        {"id":"6","x":521.43274,"y":160.91298},
                        {"id":"7","x":442.27356,"y":175.33836},
                        {"id":"8","x":439.3507,"y":231.71849},
                        {"id":"9","x":436.74188,"y":257.77667},
                        {"id":"10","x":435.17743,"y":279.97467},
                        {"id":"11","x":396.88416,"y":254.21063},
                        {"id":"12","x":475.95074,"y":259.8048},
                        {"id":"13","x":458.44965,"y":238.42041},
                        {"id":"14","x":416.88675,"y":235.4068},
                        {"id":"15","x":436.03284,"y":267.02917},
                        {"id":"16","x":437.73734,"y":243.83968},
                        {"id":"17","x":417.40878,"y":178.04268},
                        {"id":"18","x":395.66534,"y":178.76361},
                        {"id":"19","x":378.18756,"y":171.57492},
                        {"id":"20","x":507.06186,"y":179.79442},
                        {"id":"21","x":487.57977,"y":184.61942},
                        {"id":"22","x":467.6681,"y":181.23442},
                        {"id":"23","x":392.74457,"y":148.52748},
                        {"id":"24","x":496.00882,"y":155.18613},
                        {"id":"25","x":431.2524,"y":315.011}
                    ],
                    "roll":4.019112,
                    "top":78.92129,
                    "width":175.71179,
                    "yaw":0.6152183
                }
            }
        ],
        "serialNo":"5893465d31284468a8014de6ee430f8e",
        "status":0,
        "usedTime":0
    }
}
```
