# 人脸检测与属性分析

## 一、接口描述 

### 1.功能描述

人脸自然属性识别API主要用于对传入的图片中所有人脸的自然属性判别，主要有：人脸框，人脸关键点信息，人脸姿态估计，9种自然属性，分别为（性别、年龄、种族、微笑、颜值，是否带墨镜，是否带眼镜，人脸是否遮挡，是否有胡子）以及5种情绪(惊讶，高兴，悲伤，生气，平静)的分析。使用者可以根据实际的使用场景选择所需的属性判别结果，api结果将返回人脸位置及相应的属性值。不适用于大规模人脸很小的合影照。

### 2. 接口使用 
公测期间用户可以免费（0元）进行测试，根据[购买流程](../Pricing/Purchase-Process.md)下单后，即可开始体验业内领先的人工智能API服务。公测期间服务具有调用量、QPS限制，如需更高性能的API服务，请联系客服扩容购买。


在获得使用权限后，您可使用已经封装好的SDK/参照[接口鉴权](../Operation-Guide/Authentication.md)规则进行相应开发，整体流程详见[调用方法](../Operation-Guide/call-methods.md)  。

### 3.图片要求

> 1. 图片格式：bmp, jpg, jpeg, png, jfif
> 2. 图片像素尺寸：最小 48\*48 像素，最大 4096\*4096 像素
> 3. 图片文件大小：小于2MB

## 二、请求说明

### 1. 接口地址 ：

```
https://aiapi.jdcloud.com/jdai/face_detect_attr
```

### 2. 请求方式：
  
https `post` aiapi.jdcloud.com/jdai/face_detect_attr

### 3. 请求参数  
 
#### （1）header请求参数
业务请求参数

名称 | 类型 | 必填 | 示例值 | 描述
------|-----|-----|-----|-----
Authorization | string | 是 | JDCLOUD2-HMAC-SHA256Credential=access... | 签名

#### （2）query请求参数
业务请求参数

名称 | 类型 | 必填 | 示例值 | 描述
------|-----|-----|-----|-----
return_landmark | int | 否 | 0 | 是否返回关键点，0为不返回，1为返回25个关键点，2为返回106个关键点，默认为0
return_attr | int | 否 | 0 | 是否返回人脸属性，0为不返回，1为返回，默认为0
face_detect_num | int | 否 | 5 | 最多处理人脸的数目，默认值为0，检测图片中所有的人脸，并返回相应的属性值, 人脸数目不超过100

#### （3）body请求参数
业务请求参数
```
imageBase64=xxxx
```
其中参数定义

名称 | 类型 | 必填 | 示例值 | 描述
------|-----|-----|-----|-----
imageBase64 | string | 是 | 图像Base64编码值，由于过长，不给出示例 | 图片Base64编码

### 4、请求代码示例
建议您使用我们提供的SDK进行调用，SDK获取及调用方式详见[sdk的使用方法](../Operation-Guide/Use-Sdk.md)
 
## 返回说明

### 1、返回参数
#### （1）公共返回参数

名称 | 类型 | 示例值 | 描述
------|-----|-----|-----
code | string | 1000 | 参见[错误码](Error-Code.md)-系统级错误码
charge | boolean | false 或 true | false：不扣费， true：扣费
remain | long | 1305 | 按天计算剩余调用次数
msg | string | 查询成功 | 参见[错误码](Error-Code.md)-系统级错误码
result | object | {...} | 查询结果

#### （2）业务返回参数

名称 | 类型 | 示例值 | 描述
------|-----|-----|-----
status | int | 0 | 返回结果，0表示成功；非0为对应错误号，参见[错误码](Error-Code.md)-业务级错误码
message | string | Success | 错误信息，参见[错误码](Error-Code.md)-业务级错误码
faceNum | int | 2 | 被检测出人脸的个数
faces | array | [{...},{...}] | 被检测出的人脸数组

 
**faces数组中单个元素的结构：**


名称 | 类型 | 示例值 | 描述
------|-----|-----|-----
faceDetectionResult | object | "faceDetectionResult":{"conf":0.9979284,<br/>"height":248.6062,<br/>"left":130.61546,<br/>"pitch":-13.489692,<br/>"points":[<br/>{"id":"1","x":182.95001,"y":336.23602},<br/>{"id":"2","x":280.43008,"y":317.094},....<br/>{"id":"25","x":261.8835,"y":481.9718}],<br/>"roll":-10.862732,<br/>"top":217.24722,<br/>"width":206.0797,<br/>"yaw":-2.1396933} | 人脸识别矩形框的位置，包括以下属性值：<br/>left：矩形框左上角像素点的横坐标<br/>top：矩形框左上角像素点的纵坐标<br/>width：矩形框的宽度<br/>height：矩形框的高度<br/>conf: 人脸置信度 <br/>roll: 人脸歪头的角度 <br/>yaw: 人脸左右摇头的角度 <br/>pitch: 人脸上下点头的角度<br/>points: 人脸关键点 
faceAttribute | object | "faceAttribute":{<br/>"age":13,<br/>"beard":0,<br/>"beauty":69.65329,<br/>"emotion":3,<br/>"eyeglasses":0,<br/>"gender":1,<br/>"mask":0,<br/>"race":0,<br/>"smile":21.505215,<br/>"sunglasses":0} | 人脸识别的自然属性值，包括以下字段，且均为string：<br>age: 年龄<br/>gender: 性别, 0为女性，1为男性<br/>race: 种族, 0白种人 1黑种人 2黄种人<br/>emotion: 0为惊讶，3为高兴，4为悲伤，5为生气，6为平静<br/>beard: 是否有胡子,0否，1是<br/>mask: 是否带口罩，0否，1是<br/>eyeglasses: 是否戴眼镜，0否，1是<br/>sunglasses: 是否带墨镜，0否，1是<br/>smile：微笑<br/>beauty：颜值

### 2、返回示例

```Json
{
    "status": 0, 
    "charge": false,
    "remain": 97,
    "msg": "查询成功",
    "result": 
    {
    		"requestid": "5893465d31284468a8014de6ee430f8e",
        "errorMsg":"success",
        "faceNum":2,
        "faces":
        [
            {
                "faceAttribute":
                {
                    "age":13,
                    "beard":0,
                    "beauty":69.65329,
                    "emotion":3,
                    "eyeglasses":0,
                    "gender":1,
                    "mask":0,
                    "race":0,
                    "smile":21.505215,
                    "sunglasses":0
                },
                "faceDetectionResult":
                {
                    "conf":0.9979284,
                    "height":248.6062,
                    "left":130.61546,
                    "pitch":-13.489692,
                    "points":
                    [
                        {"id":"1","x":182.95001,"y":336.23602},
                        {"id":"2","x":280.43008,"y":317.094},
                        {"id":"3","x":143.76604,"y":323.54022},
                        {"id":"4","x":202.72226,"y":315.76984},
                        {"id":"5","x":251.93193,"y":305.6577},
                        {"id":"6","x":312.30237,"y":290.91382},
                        {"id":"7","x":230.36914,"y":325.7189},
                        {"id":"8","x":241.39957,"y":386.72913},
                        {"id":"9","x":249.25041,"y":420.46594},
                        {"id":"10","x":253.68869,"y":442.1404},
                        {"id":"11","x":212.0619,"y":431.59692},
                        {"id":"12","x":290.02234,"y":416.03897},
                        {"id":"13","x":265.28052,"y":390.88385},
                        {"id":"14","x":222.38489,"y":399.56726},
                        {"id":"15","x":251.12921,"y":429.38632},
                        {"id":"16","x":244.89241,"y":401.36395},
                        {"id":"17","x":205.1922,"y":336.0168},
                        {"id":"18","x":182.9361,"y":343.09613},
                        {"id":"19","x":162.54597,"y":340.50223},
                        {"id":"20","x":301.3431,"y":313.41156},
                        {"id":"21","x":281.96387,"y":323.736},
                        {"id":"22","x":259.6537,"y":325.03998},
                        {"id":"23","x":170.6153,"y":312.89862},
                        {"id":"24","x":281.84644,"y":290.98724},
                        {"id":"25","x":261.8835,"y":481.9718}
                    ],
                    "roll":-10.862732,
                    "top":217.24722,
                    "width":206.0797,
                    "yaw":-2.1396933
                }
            },
            {
                "faceAttribute":
                {
                    "age":8,
                    "beard":0,
                    "beauty":83.39522,
                    "emotion":3,
                    "eyeglasses":0,
                    "gender":0,
                    "mask":0,
                    "race":0,
                    "smile":70.24126,
                    "sunglasses":0
                },
                "faceDetectionResult":
                {
                    "conf":0.9919769,
                    "height":227.42416,
                    "left":351.1377,
                    "pitch":-16.438887,
                    "points":
                    [
                        {"id":"1","x":397.53885,"y":172.85367},
                        {"id":"2","x":487.776,"y":178.55371},
                        {"id":"3","x":366.0182,"y":151.2645},
                        {"id":"4","x":420.70135,"y":158.58098},
                        {"id":"5","x":467.41974,"y":161.50757},
                        {"id":"6","x":521.43274,"y":160.91298},
                        {"id":"7","x":442.27356,"y":175.33836},
                        {"id":"8","x":439.3507,"y":231.71849},
                        {"id":"9","x":436.74188,"y":257.77667},
                        {"id":"10","x":435.17743,"y":279.97467},
                        {"id":"11","x":396.88416,"y":254.21063},
                        {"id":"12","x":475.95074,"y":259.8048},
                        {"id":"13","x":458.44965,"y":238.42041},
                        {"id":"14","x":416.88675,"y":235.4068},
                        {"id":"15","x":436.03284,"y":267.02917},
                        {"id":"16","x":437.73734,"y":243.83968},
                        {"id":"17","x":417.40878,"y":178.04268},
                        {"id":"18","x":395.66534,"y":178.76361},
                        {"id":"19","x":378.18756,"y":171.57492},
                        {"id":"20","x":507.06186,"y":179.79442},
                        {"id":"21","x":487.57977,"y":184.61942},
                        {"id":"22","x":467.6681,"y":181.23442},
                        {"id":"23","x":392.74457,"y":148.52748},
                        {"id":"24","x":496.00882,"y":155.18613},
                        {"id":"25","x":431.2524,"y":315.011}
                    ],
                    "roll":4.019112,
                    "top":78.92129,
                    "width":175.71179,
                    "yaw":0.6152183
                }
            }
        ],
        "serialNo":"5893465d31284468a8014de6ee430f8e",
        "status":0,
        "usedTime":0
    }
}
```
